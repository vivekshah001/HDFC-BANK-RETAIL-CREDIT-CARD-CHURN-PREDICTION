# -*- coding: utf-8 -*-
"""Hdfc App.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1Ni8jINjzDQG1cueJiBvmZdaFotLkmX3C
"""


import streamlit as st
import pandas as pd
import joblib

# =======================
# PAGE CONFIG (optional)
# =======================
st.set_page_config(page_title="HDFC Credit Card Churn Prediction")

# =======================
# UI THEME / CSS
# =======================
st.markdown(
    """
    <style>
    .stApp {
        background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
        color: white;
    }
    </style>
    """,
    unsafe_allow_html=True
)

# =======================
# ðŸ”¥ LOGO â€” YAHAN DALO ðŸ”¥
# # # =======================
# col1, col2, col3 = st.columns([1, 1, 1])
# with col2:
#     st.image("HDB.png", width=80)

# =======================
# TITLE â€” LOGO KE BAAD
# # =======================
# st.markdown(
#     """
#     <style>
#     .header-title {
#         font-size: 42px;
#         font-weight: 900;
#         text-align: center;
#         margin-bottom: 10px;
#     }
#     </style>

#     <div class="header-title">
#         HDFC Credit Card Churn Prediction
#     </div>
#     """,
#     unsafe_allow_html=True
# )




# =======================
# HEADER (LOGO LEFT + TITLE)NEW
# =======================
col_logo, col_title = st.columns([1, 8])

with col_logo:
    st.image("HDB.png", width=90)

with col_title:
    st.markdown(
        """
        <style>
        .main-title {
            font-size: 64px;
            font-weight: 900;
            color: white;
            margin-top: 18px;
        }
        </style>

        <div class="main-title">
            HDFC Credit Card Churn Prediction
        </div>
        """,
        unsafe_allow_html=True
    )

st.markdown(
    "<hr style='border:1px solid rgba(255,255,255,0.3); margin-bottom:30px;'>",
    unsafe_allow_html=True
)







































# purane code necha h
# ISKE NECHA MAT TOUCH KARO AAGAR CODE MESSY HO JAYEGA TOH KAM AAYEGA 


# =======================
# UI THEME (SAFE)
# =======================
# st.markdown(
#     """
#     <style>
#     /* App background */
#     .stApp {
#         background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
#         color: white;
#     }

#     /* Sidebar (if any) */
#     section[data-testid="stSidebar"] {
#         background-color: #111827;
#     }

#     /* Input labels */
#     label {
#         color: #e5e7eb !important;
#         font-weight: 600;
#     }

#     /* Number input / selectbox text */
#     input, textarea, select {
#         color: black !important;
#     }

#     /* Buttons */
#     div.stButton > button {
#         background-color: #e31837;
#         color: white;
#         border-radius: 8px;
#         height: 3em;
#         width: 100%;
#         font-size: 16px;
#         font-weight: bold;
#         border: none;
#     }

#     div.stButton > button:hover {
#         background-color: #b5122b;
#         color: white;
#     }

#     /* Result card */
#     .result-box {
#         background-color: rgba(255, 255, 255, 0.12);
#         padding: 20px;
#         border-radius: 14px;
#         margin-top: 20px;
#         box-shadow: 0 8px 20px rgba(0,0,0,0.25);
#     }
#     </style>
#     """,
#     unsafe_allow_html=True
# )



# ============================
# header
# ============================

# st.markdown(
#     """
#     <style>
#     .header-container {
#         display: flex;
#         align-items: center;
#         justify-content: center;
#         gap: 18px;
#         margin-bottom: 25px;
#     }

#     .header-container img {
#         height: 70px;
#     }

#     .header-title {
#         font-size: 42px;
#         font-weight: 900;
#         color: white;
#         letter-spacing: 0.5px;
#     }

#     .header-divider {
#         height: 2px;
#         background: linear-gradient(to right, transparent, #ffffff, transparent);
#         margin: 15px 0 30px 0;
#     }
#     </style>

#     <div class="header-container">
#         <img src="https://upload.wikimedia.org/wikipedia/commons/5/5c/HDFC_Bank_Logo.svg">
#         <div class="header-title">HDFC Credit Card Churn Prediction</div>
#     </div>

#     <div class="header-divider"></div>
#     """,
#     unsafe_allow_html=True
# )







# =======================================================================


@st.cache_resource
def load_artifacts():
    transformer = joblib.load("transformer_hdfc_churn_pipeline.pkl")
    model = joblib.load("Hdfc bank model.pkl")
    target_encoder = joblib.load("target_encoder.pkl")
    return transformer, model, target_encoder

transformer, model, target_encoder = load_artifacts()


# st.title("HDFC Credit Card Churn Prediction")

# =======================
# Categorical Inputs (5)
# =======================

gender = st.selectbox("Gender", ["M", "F"])
education = st.selectbox("Education Level", [
    "Uneducated","High School","College","Graduate","Post-Graduate","Doctorate","Unknown"
])
marital = st.selectbox("Marital Status", ["Single","Married","Divorced"])
income = st.selectbox("Income Category", [
    "Less than $40K","$40K - $60K","$60K - $80K","$80K - $120K","$120K +","Unknown"
])
card = st.selectbox("Card Category", ["Blue","Silver","Gold","Platinum"])

# =======================
# Numerical Inputs (12)
# =======================
Customer_Age = st.number_input("Customer Age", 18, 100, 40)
Dependent_count = st.number_input("Dependent Count", 0, 10, 2)
Customer_Tenure_Months = st.number_input("Customer Tenure (Months)", 0, 100, 36)
Number_of_Bank_Products = st.number_input("Number of Bank Products", 1, 10, 3)
Months_Inactive_12_mon = st.number_input("Months Inactive (Last 12 Months)", 0, 12, 2)
Contacts_Count_12_mon = st.number_input("Contacts Count (Last 12 Months)", 0, 20, 2)
Credit_Limit = st.number_input("Credit Limit", 0.0, 500000.0, 100000.0)
Total_Revolving_Bal = st.number_input("Total Revolving Balance", 0.0, 100000.0, 5000.0)
Available_Credit_Left = st.number_input("Available Credit Left", 0.0, 500000.0, 50000.0)
Total_Trans_Ct = st.number_input("Total Transactions Count", 0, 500, 50)
Total_Trans_Amt = st.number_input("Total Transaction Amount", 0.0, 1000000.0, 200000.0)
Avg_Utilization_Ratio = st.number_input("Average Utilization Ratio", 0.0, 1.0, 0.3)

# =================
# input(17)
# =================

input_df = pd.DataFrame([{
    "Gender": gender,
    "Education_Level": education,
    "Marital_Status": marital,
    "Income_Category": income,
    "Card_Category": card,
    "Customer_Age": Customer_Age,
    "Dependent_count": Dependent_count,
    "Customer_Tenure_Months": Customer_Tenure_Months,
    "Number_of_Bank_Products": Number_of_Bank_Products,
    "Months_Inactive_12_mon": Months_Inactive_12_mon,
    "Contacts_Count_12_mon": Contacts_Count_12_mon,
    "Credit_Limit": Credit_Limit,
    "Total_Revolving_Bal(debt)": Total_Revolving_Bal,
    "Available Credit Left": Available_Credit_Left,
    "total no of trans": Total_Trans_Ct,
    "Total_Trans_Amt": Total_Trans_Amt,
    "Avg_Utilization_Ratio": Avg_Utilization_Ratio
    # add ALL remaining numeric columns here
}])

# =======================
# Prediction
# # =======================


# if st.button("Predict Churn"):
#     try:
#         X_transformed = transformer.transform(input_df)

#         pred = model.predict(X_transformed)[0]

#         if pred == 1:
#             final_label = "Churned"
#         else:
#             final_label = "Not Churned"

#         st.subheader("Result")
#         st.write("Prediction:", final_label)

#     except Exception as e:
#         st.error("Prediction failed")
#         st.exception(e)









if st.button("Predict Churn"):
    try:
        X_transformed = transformer.transform(input_df)

        pred = model.predict(X_transformed)[0]

        if pred == 1:
            final_label = "Churned"
        else:
            final_label = "Not Churned"

        st.subheader("Result")

        if final_label == "Churned":
            st.markdown(
                f"""
                <div class="result-box">
                    <h3 style="color:#ff4b4b;">âš  Customer Likely to Churn</h3>
                    <p><b>Status:</b> {final_label}</p>
                </div>
                """,
                unsafe_allow_html=True
            )
        else:
            st.markdown(
                f"""
                <div class="result-box">
                    <h3 style="color:#00ff9c;">âœ… Customer Safe</h3>
                    <p><b>Status:</b> {final_label}</p>
                </div>
                """,
                unsafe_allow_html=True
            )

    except Exception as e:
        st.error("Prediction failed")
        st.exception(e)



