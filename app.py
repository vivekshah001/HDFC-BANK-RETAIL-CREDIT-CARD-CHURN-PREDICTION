# -*- coding: utf-8 -*-
"""Hdfc App.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1Ni8jINjzDQG1cueJiBvmZdaFotLkmX3C
"""

import streamlit as st
import joblib
import pandas as pd

@st.cache_resource
def load_artifacts():
    transformer = joblib.load("transformer_hdfc_churn_pipeline.pkl")
    model = joblib.load("Hdfc bank model.pkl")
    target_encoder = joblib.load("target_encoder.pkl")
    return transformer, model, target_encoder

transformer, model, target_encoder = load_artifacts()


st.title("HDFC Credit Card Churn Prediction")

# =======================
# Categorical Inputs (5)
# =======================

gender = st.selectbox("Gender", ["M", "F"])
education = st.selectbox("Education Level", [
    "Uneducated","High School","College","Graduate","Post-Graduate","Doctorate","Unknown"
])
marital = st.selectbox("Marital Status", ["Single","Married","Divorced"])
income = st.selectbox("Income Category", [
    "Less than $40K","$40K - $60K","$60K - $80K","$80K - $120K","$120K +","Unknown"
])
card = st.selectbox("Card Category", ["Blue","Silver","Gold","Platinum"])

# =======================
# Numerical Inputs (12)
# =======================
Customer_Age = st.number_input("Customer Age", 18, 100, 40)
Dependent_count = st.number_input("Dependent Count", 0, 10, 2)
Customer_Tenure_Months = st.number_input("Customer Tenure (Months)", 0, 100, 36)
Number_of_Bank_Products = st.number_input("Number of Bank Products", 1, 10, 3)
Months_Inactive_12_mon = st.number_input("Months Inactive (Last 12 Months)", 0, 12, 2)
Contacts_Count_12_mon = st.number_input("Contacts Count (Last 12 Months)", 0, 20, 2)
Credit_Limit = st.number_input("Credit Limit", 0.0, 500000.0, 100000.0)
Total_Revolving_Bal = st.number_input("Total Revolving Balance", 0.0, 100000.0, 5000.0)
Available_Credit_Left = st.number_input("Available Credit Left", 0.0, 500000.0, 50000.0)
Total_Trans_Ct = st.number_input("Total Transactions Count", 0, 500, 50)
Total_Trans_Amt = st.number_input("Total Transaction Amount", 0.0, 1000000.0, 200000.0)
Avg_Utilization_Ratio = st.number_input("Average Utilization Ratio", 0.0, 1.0, 0.3)

# =================
# input(17)
# =================

input_df = pd.DataFrame([{
    "Gender": gender,
    "Education_Level": education,
    "Marital_Status": marital,
    "Income_Category": income,
    "Card_Category": card,
    "Customer_Age": Customer_Age,
    "Dependent_count": Dependent_count,
    "Customer_Tenure_Months": Customer_Tenure_Months,
    "Number_of_Bank_Products": Number_of_Bank_Products,
    "Months_Inactive_12_mon": Months_Inactive_12_mon,
    "Contacts_Count_12_mon": Contacts_Count_12_mon,
    "Credit_Limit": Credit_Limit,
    "Total_Revolving_Bal(debt)": Total_Revolving_Bal,
    "Available Credit Left": Available_Credit_Left,
    "total no of trans": Total_Trans_Ct,
    "Total_Trans_Amt": Total_Trans_Amt,
    "Avg_Utilization_Ratio": Avg_Utilization_Ratio
    # add ALL remaining numeric columns here
}])

# =======================
# Prediction
# =======================
if st.button("Predict Churn"):
    pred = pipeline.predict(input_df)[0]
    prob = pipeline.predict_proba(input_df)[0][1]
    label = target_encoder.inverse_transform([pred])[0]

    st.subheader("Result")
    st.write("Prediction:", label)
    st.write("Churn Probability:", round(prob, 2))
